# Endotheliosis Quantifier CLI Usage

The `eq` package provides a command-line interface for running the endotheliosis quantification pipeline.

## Installation

After installing the package in development mode:

```bash
pip install -e .
```

The `eq` command will be available in your environment.

## Available Commands

### 1. Data Loading (`data-load`)

Load and preprocess data for the pipeline:

```bash
eq data-load --data-dir data/train --test-data-dir data/test --cache-dir data/cache
```

**Options:**
- `--data-dir`: Training data directory (required)
- `--test-data-dir`: Test data directory (required)
- `--cache-dir`: Cache directory for processed data (required)
- `--annotation-file`: Annotation JSON file (optional)
- `--image-size`: Image size for processing (default: 256)

### 2. Train Segmentation Model (`train-segmenter`)

Train a segmentation model for glomeruli detection:

```bash
eq train-segmenter --base-model-path models/base_model.h5 --cache-dir data/cache --output-dir output
```

**Options:**
- `--base-model-path`: Path to base model (required)
- `--cache-dir`: Cache directory (required)
- `--output-dir`: Output directory (required)
- `--model-name`: Model name (default: glomerulus_segmenter)
- `--batch-size`: Batch size (default: 8)
- `--epochs`: Number of epochs (default: 50)

### 3. Extract Features (`extract-features`)

Extract features from images using a trained model:

```bash
eq extract-features --cache-dir data/cache --output-dir output --model-path models/trained_model.h5
```

**Options:**
- `--cache-dir`: Cache directory (required)
- `--output-dir`: Output directory (required)
- `--model-path`: Path to trained model (required)

### 4. Quantify Endotheliosis (`quantify`)

Run the main endotheliosis quantification:

```bash
eq quantify --cache-dir data/cache --output-dir output --model-path models/trained_model.h5
```

**Options:**
- `--cache-dir`: Cache directory (required)
- `--output-dir`: Output directory (required)
- `--model-path`: Path to trained model (required)

### 5. Complete Pipeline (`pipeline`)

Run the complete pipeline end-to-end:

```bash
eq pipeline --data-dir data/train --test-data-dir data/test --cache-dir data/cache --output-dir output --base-model-path models/base_model.h5
```

**Options:**
- `--data-dir`: Training data directory (required)
- `--test-data-dir`: Test data directory (required)
- `--cache-dir`: Cache directory (required)
- `--output-dir`: Output directory (required)
- `--base-model-path`: Path to base model (required)
- `--annotation-file`: Annotation JSON file (optional)
- `--image-size`: Image size for processing (default: 256)
- `--batch-size`: Batch size (default: 8)
- `--epochs`: Number of epochs (default: 50)

## Examples

### Basic Usage

```bash
# Load data
eq data-load --data-dir data/train --test-data-dir data/test --cache-dir data/cache

# Train model
eq train-segmenter --base-model-path models/base_model.h5 --cache-dir data/cache --output-dir output

# Extract features
eq extract-features --cache-dir data/cache --output-dir output --model-path output/glomerulus_segmentation/glomerulus_segmenter.h5

# Quantify
eq quantify --cache-dir data/cache --output-dir output --model-path output/glomerulus_segmentation/glomerulus_segmenter.h5
```

### Complete Pipeline

```bash
eq pipeline \
  --data-dir data/train \
  --test-data-dir data/test \
  --cache-dir data/cache \
  --output-dir output \
  --base-model-path models/base_model.h5 \
  --annotation-file data/annotations.json
```

## Help

Get help for any command:

```bash
eq --help
eq data-load --help
eq train-segmenter --help
eq extract-features --help
eq quantify --help
eq pipeline --help
```

## Notes

- All commands require the `eq` conda environment to be activated
- The cache directory is used to store intermediate processed data
- Output directories will be created automatically if they don't exist
- Some commands may take significant time depending on data size and model complexity
