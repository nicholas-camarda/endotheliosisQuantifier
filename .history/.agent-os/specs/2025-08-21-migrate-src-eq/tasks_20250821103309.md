# Spec Tasks

## Tasks

- [ ] 1. Establish `src/eq` package structure and imports
  - [ ] 1.1 Write tests: verify package discovery/imports for `eq` and subpackages
  - [ ] 1.2 Create directories and `__init__.py`: `eq/io`, `eq/augment`, `eq/patches`, `eq/models`, `eq/segmentation`, `eq/features`, `eq/metrics`, `eq/pipeline`, `eq/utils`
  - [ ] 1.3 Ensure `pyproject.toml` discovers `eq*` packages; add missing `__init__.py` if any
  - [ ] 1.4 Verify: run tests for task 1 and confirm imports succeed

- [ ] 2. Migrate IO and preprocessing utilities (non-destructive with `mv` + shims)
  - [ ] 2.1 Write tests: explicit assertions for `patchify_images`, `convert_files_to_jpg`, `preprocess_roi`
  - [ ] 2.2 Move files with `mv`:
        `scripts/utils/convert_files_to_jpg.py` → `src/eq/io/convert_files_to_jpg.py`
        `scripts/utils/patchify_images.py` → `src/eq/patches/patchify_images.py`
        `scripts/utils/generate_augmented_dataset.py` → `src/eq/augment/augment_dataset.py`
        `scripts/utils/preprocess_ROI_then_extract_features.py` → `src/eq/features/preprocess_roi.py`
  - [ ] 2.3 Add compatibility shims in original locations importing from `eq.*` to avoid breaking existing calls
  - [ ] 2.4 Verify: run tests for task 2 and confirm behavior on small real data slices

- [ ] 3. Migrate feature extraction and pipeline logic
  - [ ] 3.1 Write tests: explicit assertions for `feature_extractor_helper_functions` and `quantify_endotheliosis` key outputs on small inputs
  - [ ] 3.2 Move files with `mv`:
        `scripts/main/feature_extractor_helper_functions.py` → `src/eq/features/helpers.py`
        `scripts/main/quantify_endotheliosis.py` → `src/eq/pipeline/quantify_endotheliosis.py`
  - [ ] 3.3 Update `scripts/main/*.py` to import from `eq.*` while keeping CLI params unchanged
  - [ ] 3.4 Verify: run tests, then `mamba run -n eq python scripts/utils/smoke_test_pipeline.py`

- [ ] 4. CLI wrappers and documentation alignment
  - [ ] 4.1 Write tests: wrappers import-calls `eq.*` functions and return expected values
  - [ ] 4.2 Create/adjust thin wrappers in `scripts/main` and `scripts/utils` to call into `eq.*`
  - [ ] 4.3 Update `README.md` examples to prefer `python -m eq.pipeline.quantify_endotheliosis` where appropriate
  - [ ] 4.4 Verify: `scripts/utils/runtime_check.py` and wrappers run successfully

- [ ] 5. Cleanup, linters, and docs
  - [ ] 5.1 Write tests for docs: examples reference `eq.*`, no stale paths
  - [ ] 5.2 Move `scripts/main/unused/` to an archive folder; ensure no imports break
  - [ ] 5.3 Add `eq/utils/logging.py` and `eq/utils/paths.py` if needed; integrate minimal logging and path handling
  - [ ] 5.4 Verify: run full tests; ruff lint; smoke test pipeline


